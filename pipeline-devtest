pipeline {
    agent any
    
    stages {
        stage('Build') {
            steps {
                script {
                    sh '/opt/maven/bin/mvn clean package'
                }
            }
        }
        stage('Test') {
            steps {
                script {
                    sh '/opt/maven/bin/mvn test'
                }
            }
        }
        stage('Deploy') {
            steps {
                script {
                    // Remove existing war files from Tomcat webapps directory
                    sh "sudo rm -rf ~/apache*/webapps/*.war"
                    // Deploy the newly built war file to Tomcat webapps directory
                    sh "sudo mv target/*.war ~/apache*/webapps/"
                    // Reload systemd daemon
                    sh "sudo systemctl daemon-reload"
                    // Restart Tomcat
                    sh "sudo ~/apache-tomcat-7.0.94/bin/shutdown.sh && sudo ~/apache-tomcat-7.0.94/bin/startup.sh"
                }
            }
        }
    }
    
 
}
